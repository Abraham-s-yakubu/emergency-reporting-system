{% load static %}
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>{% block title %}Accident Dashboard{% endblock %}</title>
		<link
			rel="stylesheet"
			href="{% static 'css/admin css/accident css/general style accident.css' %}"
		/>
		{% block extra_css %}
		<link
			rel="stylesheet"
			href="{% static 'css/admin css/accident css/accident main dashboard.css' %}"
		/>
		{% endblock %}
		<!-- Inter Font -->
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
			rel="stylesheet"
		/>
		<!-- Font Awesome for Icons -->
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
		/>
	</head>
	<body class="flex min-h-screen">
		<!-- 
    ================================================================================
    --- START GENERAL LAYOUT HTML (To be placed in your base.html) ---
    ================================================================================
    -->
		<aside
			id="sidebar"
			class="bg-gray-800 text-gray-300 flex flex-col rounded-r-lg shadow-lg overflow-hidden"
		>
			<div
				class="p-4 flex items-center justify-between border-b border-gray-700 h-16"
			>
				<div class="flex items-center">
					<img
						src="https://placehold.co/32x32/1e293b/e2e8f0?text=A112"
						alt="Alert112 Logo"
						class="rounded-full mr-2 h-8 w-8 flex-shrink-0"
					/>
					<span class="sidebar-text text-xl font-bold text-white"
						>Alert112</span
					>
				</div>
				<button
					id="sidebar-pin-btn"
					aria-label="Pin sidebar"
					class="text-gray-400 hover:text-white focus:outline-none"
				>
					<i class="fas fa-unlock"></i>
				</button>
			</div>
			<nav class="flex-grow p-4 sidebar-scroll">
				<div class="mb-6">
					<h3
						class="text-xs uppercase font-semibold text-gray-500 mb-2 sidebar-text"
					>
						MENU
					</h3>
					<ul>
						<li class="mb-2">
							<a
								href="{% url 'accident_dashboard_main' %}"
								class="sidebar-nav-item{% if request.resolver_match.url_name == 'accident_dashboard_main' %}active{% endif %}"
								><i class="fas fa-car-crash sidebar-item-icon"></i>
								<span class="sidebar-text">Accident Overview</span></a
							>
						</li>
						<li class="mb-2">
							<a
								href="{% url 'accident_map' %}"
								class="sidebar-nav-item{% if request.resolver_match.url_name == 'accident_map' %}active{% endif %}"
								><i class="fas fa-map-marker-alt sidebar-item-icon"></i>
								<span class="sidebar-text">Traffic Accident Map</span></a
							>
						</li>
						<li class="mb-2">
							<a
								href="{% url 'accident_report_management' %}"
								class="sidebar-nav-item {% if request.resolver_match.url_name == 'accident_report_management' %}active{% endif %}"
								><i class="fas fa-file-alt sidebar-item-icon"></i>
								<span class="sidebar-text">Accident Report Management</span></a
							>
						</li>
						<li class="mb-2">
							<a
								href="{% url 'accident_analysis_and_trend' %}"
								class="sidebar-nav-item {% if request.resolver_match.url_name == 'accident_analysis_and_trend' %}active{% endif %}"
								><i class="fas fa-chart-pie sidebar-item-icon"></i>
								<span class="sidebar-text">Accident Analytics & Trends</span></a
							>
						</li>
						<li class="mb-2">
							<a
								href="{% url 'accident_admin' %}"
								class="sidebar-nav-item {% if request.resolver_match.url_name == 'accident_admin' %}active{% endif %}"
								><i class="fas fa-users-cog sidebar-item-icon"></i>
								<span class="sidebar-text">Admin Users</span></a
							>
						</li>
					</ul>
				</div>
				<div>
					<h3
						class="text-xs uppercase font-semibold text-gray-500 mb-2 sidebar-text"
					>
						SETTINGS
					</h3>
					<ul>
						<li class="mb-2">
							<a href="#" class="sidebar-nav-item"
								><i class="fas fa-sign-out-alt sidebar-item-icon"></i>
								<span class="sidebar-text">Logout</span></a
							>
						</li>
					</ul>
				</div>
			</nav>
			<div
				class="p-4 border-t border-gray-700 text-center text-gray-500 text-sm sidebar-text"
			>
				Accident Reporting System
			</div>
		</aside>

		<div id="main-content-wrapper" class="flex-1">
			<header id="main-header" class="mb-6">
				<!-- DJANGO NOTE: Use a block here for dynamic page titles -->
				{% block page_title %}
				<h1>Accident Dashboard <span>Overview</span></h1>
				{% endblock %}
				<div class="flex items-center space-x-5 relative">
					<button id="notificationButton" class="header-icon-button relative">
						<svg
							xmlns="http://www.w3.org/2000/svg"
							fill="none"
							viewBox="0 0 24 24"
							stroke="currentColor"
						>
							<path
								stroke
								-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"
							/>
						</svg>
						<span
							id="notification-dot"
							class="absolute top-1 right-1 block h-3 w-3 rounded-full bg-red-500 ring-2 ring-slate-900 hidden"
						></span>
					</button>
					<div
						id="notificationDropdown"
						class="dropdown-menu hidden header-dropdown"
					>
						<div class="dropdown-header flex justify-between items-center">
							<h3 class="text-lg font-semibold">New Accident Alerts</h3>
							<button class="dropdown-close-button" id="close-notification-btn">
								<svg
									xmlns="http://www.w3.org/2000/svg"
									class="h-5 w-5"
									fill="none"
									viewBox="0 0 24 24"
									stroke="currentColor"
								>
									<path
										stroke-linecap="round"
										stroke-linejoin="round"
										stroke-width="2"
										d="M6 18L18 6M6 6l12 12"
									/>
								</svg>
							</button>
						</div>
						<div class="py-2" id="notificationList">
							<div class="text-center p-4 text-slat">
								Loading notifications...
							</div>
						</div>
						<div class="dropdown-footer">
							<a href="#" id="viewAllIncidentsLink"
								>View All Accident Incidents</a
							>
						</div>
					</div>
					<div class="profile-avatar">
						<svg
							xmlns="http://www.w3.org/2000/svg"
							class="h-7 w-7"
							fill="none"
							viewBox="0 0 24 24"
							stroke="currentColor"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
							/>
						</svg>
					</div>
					<span class="profile-text hidden sm:block">Admin User</span>
				</div>
			</header>
			<!-- 
        ================================================================================
        --- END GENERAL LAYOUT HTML ---
        ================================================================================
        -->

			{% block content %}

			<!-- 
        ================================================================================
        --- START DJANGO BLOCK CONTENT ---
        ================================================================================
        -->
			<main id="main-content" class="pt-0 overflow-auto">
				<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
					<div class="dashboard-card">
						<div>
							<h4>Resolved Accident Reports</h4>
							<p
								id="resolved-reports"
								class="text-4xl font-bold text-white loading-placeholder"
							>
								Loading...
							</p>
							<div class="trend-text text-gray-400"></div>
						</div>
					</div>
					<div class="dashboard-card">
						<div>
							<h4>Pending Accident Reports</h4>
							<p
								id="pending-reports"
								class="text-4xl font-bold text-white loading-placeholder"
							>
								Loading...
							</p>
							<div class="trend-text text-gray-400"></div>
						</div>
					</div>
					<div class="dashboard-card">
						<div>
							<h4>Total Accidents This Month</h4>
							<p
								id="total-incidents-this-month"
								class="text-4xl font-bold text-white loading-placeholder"
							>
								Loading...
							</p>
							<div class="trend-text text-gray-400"></div>
						</div>
					</div>
				</div>

				<div class="dashboard-card mb-6">
					<div class="flex items-center justify-between mb-3">
						<h4 class="text-gray-400 text-sm">Monthly Accident Reports</h4>
					</div>
					<div class="h-64 loading-placeholder" id="monthly-chart-container">
						<canvas id="monthlyIncidentsChart"></canvas>
					</div>
				</div>

				<div class="dashboard-card mb-6">
					<div class="flex items-center justify-between mb-3">
						<h4 class="text-gray-400 text-sm">Accident Response Rate</h4>
					</div>
					<p class="text-gray-500 text-sm mb-3">
						Percentage of accident reports resolved efficiently.
					</p>
					<div class="flex flex-col items-center justify-center mb-3">
						<div class="progress-bar-container">
							<svg class="w-full h-full" viewBox="0 0 120 120">
								<circle
									class="progress-bar-circle progress-bar-background"
									cx="60"
									cy="60"
									r="50"
								></circle>
								<circle
									id="response-rate-progress"
									class="progress-bar-circle progress-bar-foreground"
									cx="60"
									cy="60"
									r="50"
									style="stroke-dasharray: 314; stroke-dashoffset: 314"
								></circle>
							</svg>
							<span
								id="response-rate-percentage"
								class="absolute text-white text-2xl font-bold loading-placeholder"
								>...</span
							>
						</div>
					</div>
					<p
						id="response-rate-message1"
						class="text-gray-400 text-sm text-center"
					>
						Loading data...
					</p>
					<p
						id="response-rate-message2"
						class="text-gray-400 text-sm text-center mb-3"
					></p>
					<div
						class="flex justify-around text-center border-t border-gray-700 pt-3"
					>
						<div>
							<p class="text-gray-500 text-sm">Target</p>
							<p class="text-white font-bold text-base">90%</p>
						</div>
						<div>
							<p class="text-gray-500 text-sm">Current</p>
							<p
								id="response-rate-current"
								class="text-white font-bold text-base"
							>
								-% <i class="fas fa-minus text-gray-400 text-xs"></i>
							</p>
						</div>
						<div>
							<p class="text-gray-500 text-sm">Last Month</p>
							<p
								id="response-rate-last-month"
								class="text-white font-bold text-base"
							>
								-% <i class="fas fa-minus text-gray-400 text-xs"></i>
							</p>
						</div>
					</div>
				</div>

				<div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6 mb-6">
					<div class="dashboard-card lg:col-span-1">
						<div class="flex items-center justify-between mb-3">
							<h4 class="text-gray-400 text-sm">Accident Statistics</h4>
							<div class="flex space-x-2">
								<select
									id="statisticsMonthFilter"
									class="dashboard-select"
								></select>
								<select
									id="statisticsYearFilter"
									class="dashboard-select"
								></select>
							</div>
						</div>
						<p class="text-gray-500 text-sm mb-3">
							Breakdown by impact and duplicates
						</p>
						<div
							class="h-64 loading-placeholder relative"
							id="statistics-chart-container"
						>
							<canvas id="statisticsChart"></canvas>
							<div id="noDataStatisticsMessage" class="no-data-message hidden">
								No accidents found for this period.
							</div>
						</div>
					</div>
					<div class="dashboard-card lg:col-span-1 xl:col-span-2">
						<div class="flex items-center justify-between mb-3">
							<h4 class="text-gray-400 text-sm">Active Accident Reports</h4>
						</div>
						<div class="filter-bar mb-4">
							<div class="filter-group">
								<label for="activeStatusFilter" class="text-gray-500 text-xs"
									>Status</label
								>
								<select id="activeStatusFilter" class="dashboard-select">
									<option value="all">All</option>
									<option value="Pending">Pending</option>
									<option value="Investigating">Investigating</option>
								</select>
							</div>
							<div class="filter-group">
								<label for="activeImpactFilter" class="text-gray-500 text-xs"
									>Impact</label
								>
								<select id="activeImpactFilter" class="dashboard-select">
									<option value="all">All</option>
									<option value="Fatal">Fatal</option>
									<option value="Severe">Severe</option>
									<option value="Minor">Minor</option>
								</select>
							</div>
							<div class="filter-group">
								<label for="activeSearch" class="text-gray-500 text-xs"
									>Search</label
								>
								<input
									type="text"
									id="activeSearch"
									placeholder="Location or ID..."
									class="dashboard-input"
								/>
							</div>
						</div>
						<div
							class="overflow-x-auto w-full max-h-64 overflow-y-auto"
							id="active-incidents-table-container"
						>
							<table class="min-w-full divide-y divide-gray-700 hidden">
								<thead>
									<tr>
										<th
											class="px-4 py-3 text-left text-sm font-medium text-gray-500 uppercase tracking-wider"
										>
											Incident ID
										</th>
										<th
											class="px-4 py-3 text-left text-sm font-medium text-gray-500 uppercase tracking-wider"
										>
											Location
										</th>
										<th
											class="px-4 py-3 text-left text-sm font-medium text-gray-500 uppercase tracking-wider"
										>
											Impact
										</th>
										<th
											class="px-4 py-3 text-left text-sm font-medium text-gray-500 uppercase tracking-wider"
										>
											Status
										</th>
									</tr>
								</thead>
								<tbody
									id="active-incidents-tbody"
									class="divide-y divide-gray-700"
								></tbody>
							</table>
						</div>
					</div>
					<div
						class="dashboard-card flex items-center justify-center flex-col text-center"
					>
						<h4>Manage Accident Prevention Videos</h4>
						<p class="text-gray-500 text-sm mb-4">
							Add, view, and organize educational accident prevention videos.
						</p>
						<button
							id="manageVideosButton"
							class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-colors w-full max-w-xs"
						>
							<i class="fas fa-video mr-2"></i> Open Video Manager
						</button>
					</div>
				</div>
			</main>
			<!-- 
        ================================================================================
        --- END DJANGO BLOCK CONTENT ---
        ================================================================================
        -->
		</div>
		<!-- 
    ================================================================================
    --- START PAGE-SPECIFIC MODALS (To be placed in the Django content block) ---
    ================================================================================
    -->
		<div id="videoManagementModal" class="modal-overlay hidden">
			<div class="modal-container">
				<div class="modal-header flex justify-between items-center">
					<h2>Manage Accident Prevention Videos</h2>
					<button id="closeVideoManagementModal" class="dropdown-close-button">
						<svg
							xmlns="http://www.w3.org/2000/svg"
							class="h-6 w-6"
							fill="none"
							viewBox="0 0 24 24"
							stroke="currentColor"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M6 18L18 6M6 6l12 12"
							/>
						</svg>
					</button>
				</div>
				<div class="modal-body p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
					<!-- Add New Video Form -->
					<div>
						<h3 class="text-xl font-semibold text-white mb-4">
							<span id="formTitle">Add New Video</span>
						</h3>
						<div id="addVideoMessage" class="video-message hidden"></div>
						<form id="addVideoForm">
							<div class="form-group">
								<label for="youtubeEmbedCode"
									>YouTube Embed Code (Video ID)</label
								>
								<input
									type="text"
									id="youtubeEmbedCode"
									placeholder="e.g., S1-x1Fm-QJg"
									required
									class="dashboard-input"
								/>
								<p class="text-gray-500 text-xs mt-1">
									Found in the YouTube embed URL:
									`https://www.youtube.com/embed/<span
										class="font-bold text-gray-400"
										>VIDEO_ID</span
									>`
								</p>
							</div>
							<div class="form-group">
								<label for="videoTitle">Title</label>
								<input
									type="text"
									id="videoTitle"
									placeholder="e.g., Safe Driving Tips"
									required
									class="dashboard-input"
								/>
							</div>
							<div class="form-group">
								<label for="videoDescription">Description</label>
								<textarea
									id="videoDescription"
									placeholder="A brief description of the video content."
									rows="3"
									required
									class="dashboard-input"
								></textarea>
							</div>
							<div class="form-group">
								<label for="videoCategory">Category</label>
								<select id="videoCategory" class="dashboard-select">
									<option value="">Select Category</option>
								</select>
							</div>
							<div class="form-action-buttons">
								<button type="submit" class="submit-btn" id="submitVideoButton">
									<i class="fas fa-plus-circle mr-2"></i> Add Video
								</button>
								<button
									type="button"
									class="cancel-btn hidden"
									id="cancelEditButton"
								>
									<i class="fas fa-times-circle mr-2"></i> Cancel Edit
								</button>
							</div>
						</form>
					</div>
					<!-- Existing Videos List -->
					<div>
						<h3 class="text-xl font-semibold text-white mb-4">
							Existing Videos
						</h3>
						<div class="form-group mb-4">
							<label for="videoSearchInput" class="sr-only"
								>Search Videos</label
							>
							<input
								type="text"
								id="videoSearchInput"
								placeholder="Search videos..."
								class="dashboard-input"
							/>
						</div>
						<div id="existingVideosList" class="video-gallery-modal-content">
							<!-- Videos rendered by JS -->
							<div class="text-center text-gray-500 py-8 col-span-full">
								No videos added yet.
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- 
    ================================================================================
    --- END PAGE-SPECIFIC MODALS ---
    ================================================================================
    -->
		{% endblock %}
		<!-- 
    ================================================================================
    --- START GENERAL MODALS (To be placed in your base.html) ---
    ================================================================================
    -->
		<div id="allIncidentsModal" class="modal-overlay hidden">
			<div class="modal-container">
				<div class="modal-header flex justify-between items-center">
					<h2>All Accident Incidents</h2>
					<button id="closeAllIncidentsModal" class="dropdown-close-button">
						<svg
							xmlns="http://www.w3.org/2000/svg"
							class="h-6 w-6"
							fill="none"
							viewBox="0 0 24 24"
							stroke="currentColor"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M6 18L18 6M6 6l12 12"
							/>
						</svg>
					</button>
				</div>
				<div class="modal-body">
					<div class="filter-bar">
						<div class="filter-group">
							<label for="modalStatusFilter">Status</label
							><select id="modalStatusFilter" class="dashboard-select">
								<option value="all">All</option>
								<option value="Pending">Pending</option>
								<option value="Investigating">Investigating</option>
								<option value="Resolved">Resolved</option>
							</select>
						</div>
						<div class="filter-group">
							<label for="modalImpactFilter">Impact</label
							><select id="modalImpactFilter" class="dashboard-select">
								<option value="all">All</option>
								<option value="Fatal">Fatal</option>
								<option value="Severe">Severe</option>
								<option value="Minor">Minor</option>
							</select>
						</div>
						<div class="filter-group">
							<label for="modalTimeFilter">Time</label
							><select id="modalTimeFilter" class="dashboard-select">
								<option value="all">All Time</option>
								<option value="last_24_hours">Last 24 Hours</option>
								<option value="last_7_days">Last 7 Days</option>
							</select>
						</div>
						<div class="filter-group">
							<label for="modalYearFilter">Year</label
							><select id="modalYearFilter" class="dashboard-select">
								<option value="all">All</option>
							</select>
						</div>
						<div class="filter-group">
							<label for="modalMonthFilter">Month</label
							><select id="modalMonthFilter" class="dashboard-select">
								<option value="all">All</option>
							</select>
						</div>
						<div class="filter-group">
							<label for="modalDayFilter">Day</label
							><select id="modalDayFilter" class="dashboard-select">
								<option value="all">All</option>
							</select>
						</div>
						<div class="filter-group lg:col-span-2">
							<label for="modalSearch">Search</label
							><input
								type="text"
								id="modalSearch"
								placeholder="Location or ID..."
								class="dashboard-input"
							/>
						</div>
					</div>
					<div class="overflow-y-auto">
						<table class="incidents-table">
							<thead>
								<tr>
									<th>ID</th>
									<th>Location</th>
									<th>Impact</th>
									<th>Status</th>
									<th>Date/Time</th>
									<th>Actions</th>
								</tr>
							</thead>
							<tbody id="allIncidentsTableBody"></tbody>
						</table>
					</div>
				</div>
				<div class="modal-footer">
					<span id="totalIncidentsCount">0</span> Total Incidents
				</div>
			</div>
		</div>

		<div id="confirmationModal" class="confirmation-modal-overlay hidden">
			<div class="confirmation-modal-content">
				<h3 id="confirmationModalTitle">Confirm Action</h3>
				<p id="confirmationModalMessage">Are you sure you want to proceed?</p>
				<div class="confirmation-modal-actions">
					<button id="confirmActionButton" class="submit-btn confirm-btn">
						Confirm
					</button>
					<button id="cancelActionButton" class="cancel-btn">Cancel</button>
				</div>
			</div>
		</div>
		<!-- 
    ================================================================================
    --- END GENERAL MODALS ---
    ================================================================================
    -->
		<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
		<script src="https://cdn.tailwindcss.com"></script>
		<script src="{% static 'js/admin js/accident js/general accident.js'%}"></script>
		<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
		{% block extra_js %}
		<script
			src="{% static 'js/admin js/accident js/accident main dashboard.js'%}"
			defer
		></script>
		{% endblock %}
	</body>
</html>
